<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>AWS Devliery Challenge Sample Web page</title>
    <script src="js/aws-iot-sdk-browser-bundle.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.283.1.min.js"></script>
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

    
    <link rel="stylesheet" type="text/css" href="css/controller_style.css">
</head>
<body>
  <div class="background" id="app" />
</body>

<script src="js/app-settings.js"></script>
<script src="js/app.js"></script>
<script type="text/babel"">

var NavigationControlInstance;
var WaypointFreeControlInstance;

var move_forward_down = function () {console.log("move_forward pressed"); MoveAction = "forward"; SyncJobFunction()};
var move_forward_up = function () {console.log("move_forward released"); MoveAction = "";};
var move_left_down = function () {console.log("move_left pressed"); MoveAction = "left"; SyncJobFunction()};
var move_left_up = function () {console.log("move_left released"); MoveAction = "";};
var move_right_down = function () {console.log("move_right pressed"); MoveAction = "right"; SyncJobFunction()};
var move_right_up = function () {console.log("move_right released"); MoveAction = "";};
var move_backward_down = function () {console.log("move_backward pressed"); MoveAction = "backward"; SyncJobFunction()};
var move_backward_up = function () {console.log("move_backward released"); MoveAction = "";};
var move_stop_down = function () {console.log("move_stop pressed"); MoveAction = "stop"; SyncJobFunction()};
var move_stop_up = function () {console.log("move_stop released"); MoveAction = "";};
var go_to_target = function() { GoToTargetFunction(NavigationControlInstance.state.x, NavigationControlInstance.state.y, NavigationControlInstance.state.heading) }
var free_waypoint = function() { FreeSelectWaypointFunction(WaypointFreeControlInstance.state.index) }
var navigation_start = function () { StartFunction(); }
var next_waypoint = function () { ForcedNextWaypointMapFunction(); }
var prev_waypoint = function () { ForcedPrevWaypointFunction(); }
var initial_position = function () { ReturnToInitialPositionFunction(); }
var action_restart = function () { ActionRestartFunction(); }
var action_cancel = function () { ActionCancelFunction(); }
var waypoint_strategy1 = function () { WaypointStrategy1Function(); }
var waypoint_strategy2 = function () { WaypointStrategy2Function(); }
var waypoint_strategy3 = function () { WaypointStrategy3Function(); }
var waypoint_strategy4 = function () { WaypointStrategy4Function(); }
var waypoint_strategy123 = function () { WaypointStrategy123Function(); }


window.document.onkeydown = function(event){
  switch(event.key) {
    case "ArrowUp":
      MoveAction = "forward"; SyncJobFunction();
      break;
    case "ArrowDown":
      MoveAction = "backward"; SyncJobFunction();
      break;
    case "ArrowLeft":
      MoveAction = "left"; SyncJobFunction();
      break;
    case "ArrowRight":
      MoveAction = "right"; SyncJobFunction();
      break;
    case "g":
    case "G":
      GoToTargetFunction(NavigationControlInstance.state.x, NavigationControlInstance.state.y, NavigationControlInstance.state.heading);
      break; 
    case "w":
    case "W":
      FreeSelectWaypointFunction(WaypointFreeControlInstance.state.index);
      break;

  }
}

window.document.onkeyup = function(event){
  switch(event.key) {
    case "ArrowUp":
    case "ArrowDown":
    case "ArrowLeft":
    case "ArrowRight":
      MoveAction = "stop"; SyncJobFunction();
      break;
  }
}

class Controller extends React.Component {
  render() {
    return (
      <div class="controller">
        <div class="forward">
          <button class="button move_button" onMouseDown={move_forward_down} onMouseUp={move_forward_up} >↑</button>
        </div>
        <div class="left">
          <button class="button move_button"  onMouseDown={move_left_down} onMouseUp={move_left_up}>←</button> 
        </div>
        <div className="stop">
          <button class="button move_button"  onMouseDown={move_stop_down} onMouseUp={move_stop_up}>・</button>
        </div>
        <div className="right">
          <button class="button move_button"  onMouseDown={move_right_down} onMouseUp={move_right_up}>→</button>
        </div>
        <div className="backward">
          <button class="button move_button"  onMouseDown={move_backward_down} onMouseUp={move_backward_up}>↓</button>
        </div>
      </div>
    );
  }
}

class Odometry extends React.Component {
  constructor(props) {
    super(props);
    OdometryControlInstance = this;
    this.state = { x: 0, y:0, z:0, h:0 };
  }  
  render() {
    return (
      <div class="location">
        <div class="title">Location</div>
        <div class="name">Odometry</div>
        <div class="odom_x">x</div>
        <div class="odom_y">y</div>
        <div class="odom_z">z</div>
        <div class="odom_heading">heading</div>
        <div class="odom_value_x">{this.state.x}</div>
        <div class="odom_value_y">{this.state.y}</div>
        <div class="odom_value_z">{this.state.z}</div>
        <div class="odom_value_heading">{this.state.h}</div>
      </div>
    );
  }
}

class WayNavInfo extends React.Component {
  constructor(props) {
    super(props);
    WayNavInfoControlInstance = this;
    this.state = { nextway:0, finalgoal:0, restway:0, goalremode:0,
                   goalreflag:0, accanflag:0, wayindex:0};
  }  
  render() {
    return (
      <div class="waypointnavinfo">
        <div class="title">WaypointNavInfo</div>
        <div class="name">Mode/Flag/Index</div>
        <div class="nextway">NextWaypointMode</div>
        <div class="finalgoal">FinalGoalWaypointMode</div>
        <div class="restway">ReStartWaypointMode</div>
        <div class="goalremode">GoalReachedMode</div>
        <div class="goalreflag">GoalReachedFlag</div>
        <div class="accanflag">ActionCancelFlag</div>
        <div class="wayindex">WaypointIndex</div>
        <div class="nextway_value">{this.state.nextway}</div>
        <div class="finalgoal_value">{this.state.finalgoal}</div>
        <div class="restway_value">{this.state.restway}</div>
        <div class="goalremode_value">{this.state.goalremode}</div>
        <div class="goalreflag_value">{this.state.goalreflag}</div>
        <div class="accanflag_value">{this.state.accanflag}</div>
        <div class="wayindex_value">{this.state.wayindex}</div>
      </div>
    );
  }
}

class Navigation extends React.Component {
  constructor(props) {
    super(props);
    NavigationControlInstance = this;
    this.state = { x: 0, y: 0, heading: 0 };
  }  
  render() {
    return (
      <div class="goal">
        <div class="title_goal">Goal</div>
        <div class="goal_x">x</div>
        <div class="goal_y">y</div>
        <div class="goal_heading">heading</div>
        <div class="goal_value_x"><input class="input_field" type="text" onChange={this.onChangeGoalX} value={this.state.x} /></div>
        <div class="goal_value_y"><input class="input_field" type="text" onChange={this.onChangeGoalY} value={this.state.y} /></div>
        <div class="goal_value_heading"><input class="input_field" type="text" onChange={this.onChangeGoalHeading} value={this.state.heading} /></div>
        <div class="goal_button"><button class="button action_button" onClick={go_to_target}>[G]o To</button></div>
      </div>
    );
  }

  onChangeGoalX(e) {
    NavigationControlInstance.setState({x: e.target.value});
  }
  onChangeGoalY(e) {
    NavigationControlInstance.setState({y: e.target.value});
  }
  onChangeGoalHeading(e) {
    NavigationControlInstance.setState({heading: e.target.value});
  }
}

class FreeWaypoint extends React.Component {
  constructor(props) {
    super(props);
    WaypointFreeControlInstance = this;
    this.state = { index: 0 };
  }  
  render() {
    return (
      <div class="free_waypoint">
        <div class="title_free_waypoint">FreeWaypoint</div>
        <div class="free_waypoint_index">index</div>
        <div class="free_waypoint_value_index"><input class="input_field_waypoint" type="text" onChange={this.onChangeWaypointIndex} value={this.state.index} /></div>
        <div class="free_waypoint_button"><button class="button action_button" onClick={free_waypoint}>FreeWaypointSet</button></div>
      </div>
    );
  }

  onChangeWaypointIndex(e) {
    WaypointFreeControlInstance.setState({index: e.target.value});
  } 
}

class WaypointNav extends React.Component {
  render() {
    return (
      <div class="waypointnav">
        <div class="title">WaypointNav</div>
        <div class="start">
          <div class="name">Navigation and restart controls</div>
        </div>
        <div class="next">
          <div class="name">Waypoint front and back control</div>
        </div>
        <div class="initial_position">
          <div class="name">Return to initial position</div>
        </div>
        <div class="action_restart">
          <div class="name">Action control</div>
        </div>
        <div class="waypoint_strategy1">
          <div class="name">Strategy control</div>
        </div>
      </div>
    );
  }
}

class StartNavigation extends React.Component {
  render() {
    return (
      <div class="start">
        <div class="start_button">
          <button class="button action_button" onClick={navigation_start}>StartNav/ReStartNav</button> 
        </div>
      </div>
    );
  }
}

class ForcedNextWaypoint extends React.Component {
  render() {
    return (
      <div class="next">
        <div class="next_button">
          <button class="button action_button" onClick={next_waypoint}>ForcedNext</button> 
        </div>
      </div>
    );
  }
}

class ForcedPrevWaypoint extends React.Component {
  render() {
    return (
      <div class="prev">
        <div class="prev_button">
          <button class="button action_button" onClick={prev_waypoint}>ForcedPrev</button> 
        </div>
      </div>
    );
  }
}

class ReturnToInitialPosition extends React.Component {
  render() {
    return (
      <div class="initial_position">
        <div class="initial_position_button">
          <button class="button action_button" onClick={initial_position}>InitialPosition</button> 
        </div>
      </div>
    );
  }
}

class ActionRestart extends React.Component {
  render() {
    return (
      <div class="action_restart">
        <div class="action_restart_button">
          <button class="button action_button" onClick={action_restart}>AcRestart</button> 
        </div>
      </div>
    );
  }
}

class ActionCancel extends React.Component {
  render() {
    return (
      <div class="action_cancel">
        <div class="action_cancel_button">
          <button class="button action_button" onClick={action_cancel}>AcCancel</button> 
        </div>
      </div>
    );
  }
}

class WaypointStrategy1 extends React.Component {
  render() {
    return (
      <div class="waypoint_strategy1">
        <div class="waypoint_strategy1_button">
          <button class="button action_button" onClick={waypoint_strategy1}>Strategy1</button> 
        </div>
      </div>
    );
  }
}

class WaypointStrategy2 extends React.Component {
  render() {
    return (
      <div class="waypoint_strategy2">
        <div class="waypoint_strategy2_button">
          <button class="button action_button" onClick={waypoint_strategy2}>Strategy2</button> 
        </div>
      </div>
    );
  }
}

class WaypointStrategy3 extends React.Component {
  render() {
    return (
      <div class="waypoint_strategy3">
        <div class="waypoint_strategy3_button">
          <button class="button action_button" onClick={waypoint_strategy3}>Strategy3</button> 
        </div>
      </div>
    );
  }
}

class WaypointStrategy4 extends React.Component {
  render() {
    return (
      <div class="waypoint_strategy4">
        <div class="waypoint_strategy4_button">
          <button class="button action_button" onClick={waypoint_strategy4}>Strategy4</button> 
        </div>
      </div>
    );
  }
}

class WaypointStrategy123 extends React.Component {
  render() {
    return (
      <div class="waypoint_strategy123">
        <div class="waypoint_strategy123_button">
          <button class="button action_button" onClick={waypoint_strategy123}>Strategy123</button> 
        </div>
      </div>
    );
  }
}
class GameBoard extends React.Component {
  render() {
    return (
        <div class="whiteboard">
            <div className="top">
                <Controller/>
                <WaypointNav/>
                <Odometry/>
                <WayNavInfo/>
          </div>
          <div class="bottom">
            <Navigation/>
            <FreeWaypoint/>
            <StartNavigation/>
            <ForcedNextWaypoint/>
            <ForcedPrevWaypoint/>
            <ReturnToInitialPosition/>
            <ActionRestart/>
            <ActionCancel/>
            <WaypointStrategy1/>
            <WaypointStrategy2/>
            <WaypointStrategy3/>
            <WaypointStrategy4/>
            <WaypointStrategy123/>
          </div>
        </div>
    );
  }
}

// ========

ReactDOM.render(
<GameBoard />,
document.getElementById('app')
);

if (typeof iotendpoint == "undefined") {
  let lang = (window.navigator.languages && window.navigator.languages[0]) || window.navigator.language || window.navigator.userLanguage || window.navigator.browserLanguage;
  if (lang == "ja") {
    alert("Webインターフェースエラー！設定が見つかりません。次を確認してください。(1) ビルド完了後にファイルをインストールしましたか？ 再度ビルド環境からファイルをダウンロードしてみてください (2) ファイルは展開していますか？ダウンロードしたファイルはローカル環境で解凍され、展開されている必要があります");
  } else {
    alert("No setting file found. Failed to launch the web interface. Please check (1) If you download the file after finishing the build step on your development env. Please download again if you don't. (2) If the file is extracted on your PC. If the file is not extracted, please extract it and try again.")
  }
}
</script>

</html>